(function(r,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(r=typeof globalThis<"u"?globalThis:r||self,s(r.tst={}))})(this,function(r){"use strict";const s=(o={})=>({userId:1,name:"Leo",date:new Date().getTime(),userAgent:navigator.userAgent}),d=o=>{document.addEventListener("click",t=>{const e=t.target,i=e.getAttribute("data-tracker"),n=e.getBoundingClientRect();i&&o({type:"button_event",text:i,data:{x:n.x,y:n.y,width:n.width,height:n.height}})})};function u(o){window.addEventListener("error",t=>{o({type:"error",text:t.message,data:{filename:t.filename,lineno:t.lineno,colno:t.colno,error:t.error}})})}function p(o){window.addEventListener("unhandledrejection",t=>{o({type:t.type,text:t.reason,data:{reason:t.reason,path:location.href}})})}function h(o){const t=XMLHttpRequest.prototype.open,e=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(n,a,c=!0){return o({type:"ajax",text:"request",data:{method:n,url:a,async:c}}),t.call(this,n,a,c)},XMLHttpRequest.prototype.send=function(n){return o({type:"ajax",text:"response",data:{body:n}}),e.call(this,n)};const i=window.fetch;window.fetch=function(...n){return o({type:"fetch",text:"request",data:{args:n}}),i.call(this,...n)}}function l(o){window.addEventListener("hashchange",e=>{o({type:"pageView",text:"hash",data:{newURL:e.newURL,oldURL:e.oldURL}})}),window.addEventListener("popstate",e=>{o({type:"pageView",text:"history",data:{state:e.state,title:document.title,url:location.href}})});const t=history.pushState;window.history.pushState=function(e,i,n){const a=new Event("pushState");return window.dispatchEvent(a),t.call(this,e,i,n)},window.addEventListener("pushState",e=>{o({type:"pageView",text:e.type,data:{url:location.href}})})}function f(o){let t=0;const e=new MutationObserver(i=>{console.log(i),i.forEach(n=>{t=performance.now()}),t>0&&(o({type:"onePage",text:"firstScreenTime",data:{firstScreenTime:t}}),e.disconnect())});e.observe(document.body,{childList:!0,subtree:!0})}class w{constructor(){this.events={button:d,error:u,promiseError:p,request:h,pageView:l,onePage:f},this.init()}init(){Object.keys(this.events).forEach(t=>{this.events[t](this.sendRequest)})}sendRequest(t){const e=s(),i=Object.assign({},t,e);let n=new Blob([JSON.stringify(i)],{type:"application/json"});navigator.sendBeacon("http://localhost:3000/tracker",n)}}r.Tracker=w,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
